# Quickstart Guide: Phase 2 - Todo Full-Stack Web Application

**Feature**: Phase 2 - Todo Full-Stack Web Application
**Date**: 2026-02-05
**Status**: Complete

## Overview

This guide provides step-by-step instructions for setting up, running, and testing the Phase 2 Todo API. Follow these instructions to get the API running locally with a Neon PostgreSQL database.

---

## Prerequisites

Before starting, ensure you have:

- **Python 3.13+** installed
- **UV package manager** installed (`pip install uv`)
- **Neon PostgreSQL account** with a database created
- **Git** for version control
- **curl** or **Postman** for API testing (optional)

---

## Setup Instructions

### 1. Navigate to Phase 2 Directory

```bash
cd phase-2
```

### 2. Install Dependencies

```bash
# Initialize UV project (if not already done)
uv init

# Install dependencies
uv pip install fastapi uvicorn sqlmodel psycopg2-binary alembic pydantic-settings httpx pytest
```

**Dependencies Explained**:
- `fastapi`: Web framework
- `uvicorn`: ASGI server for running FastAPI
- `sqlmodel`: ORM for database operations
- `psycopg2-binary`: PostgreSQL adapter
- `alembic`: Database migration tool
- `pydantic-settings`: Environment variable management
- `httpx`: HTTP client for testing
- `pytest`: Testing framework

### 3. Configure Environment Variables

Create a `.env` file in the `phase-2` directory:

```bash
cp .env.example .env
```

Edit `.env` with your actual values:

```env
# Database Configuration
DATABASE_URL=postgresql://user:password@ep-xxx.neon.tech/dbname?sslmode=require

# Better Auth Configuration
AUTH_SECRET_KEY=your-secret-key-here-min-32-chars
AUTH_API_URL=https://auth.example.com

# Application Configuration
APP_NAME=Phase 2 Todo API
DEBUG=true
CORS_ORIGINS=["http://localhost:3000","http://localhost:8000"]
```

**Important**: Never commit `.env` to version control. The `.env.example` file (without sensitive values) should be committed.

### 4. Initialize Database

Run Alembic migrations to create the database schema:

```bash
# Initialize Alembic (first time only)
alembic init alembic

# Generate initial migration
alembic revision --autogenerate -m "Create users and tasks tables"

# Apply migrations
alembic upgrade head
```

**Verify Database**: Check your Neon dashboard to confirm the `user` and `task` tables were created.

---

## Running the API

### Development Mode

Start the FastAPI development server with auto-reload:

```bash
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

**Output**:
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345] using StatReload
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### Production Mode

For production deployment (without auto-reload):

```bash
uvicorn src.main:app --host 0.0.0.0 --port 8000 --workers 4
```

---

## API Documentation

Once the server is running, access the interactive API documentation:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **OpenAPI JSON**: http://localhost:8000/openapi.json

These are automatically generated by FastAPI from your code and the OpenAPI specification.

---

## Testing the API

### 1. Register a New User

```bash
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "SecurePass123!",
    "name": "Alice Smith"
  }'
```

**Expected Response** (201 Created):
```json
{
  "id": 1,
  "email": "alice@example.com",
  "name": "Alice Smith",
  "created_at": "2026-02-05T10:00:00Z"
}
```

### 2. Login

```bash
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "SecurePass123!"
  }'
```

**Expected Response** (200 OK):
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "email": "alice@example.com",
    "name": "Alice Smith"
  }
}
```

**Save the access_token** for subsequent requests.

### 3. Create a Task

```bash
curl -X POST http://localhost:8000/tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "title": "Complete Phase 2 implementation",
    "description": "Implement FastAPI endpoints with SQLModel",
    "status": "pending"
  }'
```

**Expected Response** (201 Created):
```json
{
  "id": 1,
  "user_id": 1,
  "title": "Complete Phase 2 implementation",
  "description": "Implement FastAPI endpoints with SQLModel",
  "status": "pending",
  "created_at": "2026-02-05T10:30:00Z",
  "updated_at": "2026-02-05T10:30:00Z"
}
```

### 4. Get All Tasks

```bash
curl -X GET http://localhost:8000/tasks \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Expected Response** (200 OK):
```json
[
  {
    "id": 1,
    "user_id": 1,
    "title": "Complete Phase 2 implementation",
    "description": "Implement FastAPI endpoints with SQLModel",
    "status": "pending",
    "created_at": "2026-02-05T10:30:00Z",
    "updated_at": "2026-02-05T10:30:00Z"
  }
]
```

### 5. Get a Specific Task

```bash
curl -X GET http://localhost:8000/tasks/1 \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### 6. Update a Task (PUT - Full Update)

```bash
curl -X PUT http://localhost:8000/tasks/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "title": "Complete Phase 2 implementation (updated)",
    "description": "Implement FastAPI endpoints with SQLModel and tests",
    "status": "in_progress"
  }'
```

### 7. Update a Task (PATCH - Partial Update)

```bash
curl -X PATCH http://localhost:8000/tasks/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -d '{
    "status": "complete"
  }'
```

### 8. Delete a Task

```bash
curl -X DELETE http://localhost:8000/tasks/1 \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Expected Response** (204 No Content): Empty response body

### 9. Logout

```bash
curl -X POST http://localhost:8000/auth/logout \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Expected Response** (204 No Content): Empty response body

---

## Running Tests

### Run All Tests

```bash
pytest
```

### Run with Coverage

```bash
pytest --cov=src --cov-report=html
```

View coverage report: `open htmlcov/index.html`

### Run Specific Test Files

```bash
# Integration tests only
pytest tests/integration/

# Unit tests only
pytest tests/unit/

# Specific test file
pytest tests/integration/test_tasks_api.py

# Specific test function
pytest tests/integration/test_tasks_api.py::test_create_task
```

### Run with Verbose Output

```bash
pytest -v
```

---

## Common Issues and Troubleshooting

### Issue: Database Connection Failed

**Symptom**: `sqlalchemy.exc.OperationalError: could not connect to server`

**Solutions**:
1. Verify `DATABASE_URL` in `.env` is correct
2. Check Neon database is active (not suspended)
3. Verify network connectivity to Neon
4. Ensure SSL mode is set: `?sslmode=require`

### Issue: Import Errors

**Symptom**: `ModuleNotFoundError: No module named 'fastapi'`

**Solution**: Install dependencies with `uv pip install -r requirements.txt`

### Issue: Migration Errors

**Symptom**: `alembic.util.exc.CommandError: Target database is not up to date`

**Solutions**:
1. Check current migration status: `alembic current`
2. Apply pending migrations: `alembic upgrade head`
3. If needed, downgrade and re-apply: `alembic downgrade -1 && alembic upgrade head`

### Issue: Authentication Errors

**Symptom**: `401 Unauthorized` on protected endpoints

**Solutions**:
1. Verify you're including the `Authorization` header
2. Check token format: `Bearer YOUR_ACCESS_TOKEN`
3. Ensure token hasn't expired (login again)
4. Verify `AUTH_SECRET_KEY` is set in `.env`

### Issue: Port Already in Use

**Symptom**: `OSError: [Errno 48] Address already in use`

**Solutions**:
1. Kill existing process: `lsof -ti:8000 | xargs kill -9`
2. Use a different port: `uvicorn src.main:app --port 8001`

---

## Development Workflow

### 1. Make Code Changes

Edit files in `src/` directory following the project structure.

### 2. Run Tests

```bash
pytest
```

### 3. Check Code Quality (Optional)

```bash
# Format code
black src/ tests/

# Lint code
ruff check src/ tests/

# Type checking
mypy src/
```

### 4. Test API Manually

Use Swagger UI at http://localhost:8000/docs for interactive testing.

### 5. Commit Changes

```bash
git add .
git commit -m "Implement feature X"
```

---

## Database Management

### View Current Migration Status

```bash
alembic current
```

### Create a New Migration

```bash
# After modifying SQLModel models
alembic revision --autogenerate -m "Add new column to tasks"
```

### Apply Migrations

```bash
alembic upgrade head
```

### Rollback Last Migration

```bash
alembic downgrade -1
```

### Reset Database (Development Only)

```bash
# WARNING: This deletes all data
alembic downgrade base
alembic upgrade head
```

---

## Environment-Specific Configuration

### Development

```env
DEBUG=true
DATABASE_URL=postgresql://dev-user:dev-pass@localhost/todo_dev
CORS_ORIGINS=["http://localhost:3000"]
```

### Production

```env
DEBUG=false
DATABASE_URL=postgresql://prod-user:prod-pass@neon.tech/todo_prod?sslmode=require
CORS_ORIGINS=["https://app.example.com"]
```

---

## Next Steps

After completing the quickstart:

1. **Explore the API**: Use Swagger UI to test all endpoints
2. **Review the Code**: Understand the project structure in `src/`
3. **Run Tests**: Ensure all tests pass with `pytest`
4. **Read Documentation**: Review `data-model.md` and `contracts/openapi.yaml`
5. **Implement Features**: Follow tasks in `tasks.md` (generated by `/sp.tasks`)

---

## Additional Resources

- **FastAPI Documentation**: https://fastapi.tiangolo.com/
- **SQLModel Documentation**: https://sqlmodel.tiangolo.com/
- **Neon Documentation**: https://neon.tech/docs
- **Alembic Documentation**: https://alembic.sqlalchemy.org/
- **Better Auth Documentation**: [TBD - add when available]

---

## Support

For issues or questions:
1. Check this quickstart guide
2. Review the feature specification in `spec.md`
3. Check the implementation plan in `plan.md`
4. Consult the project constitution in `.specify/memory/constitution.md`

---

**Quickstart Status**: âœ… Complete
**Next Step**: Run `/sp.tasks` to generate implementation tasks
